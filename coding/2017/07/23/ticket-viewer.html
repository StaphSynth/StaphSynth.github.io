<!DOCTYPE html> <html> <head> <meta charset="utf-8"/> <meta name="viewport" content="width=device-width, initial-scale=1"/> <title> Ticket Viewer | Syntheta.se </title> <script type="text/javascript" src="https://use.fontawesome.com/0523816ffe.js"></script> <link rel="alternate" type="application/rss+xml" title="Syntheta.se RSS" href="/feed.xml"/> <link type="text/css" rel="stylesheet" href="/assets/css/main.css"/> <link type="text/css" rel="stylesheet" href="/assets/css/syntax.css"/> <link rel="icon" type="image/png" href="/assets/images/favicon-32x32.png" sizes="32x32"/> <link rel="icon" type="image/png" href="/assets/images/favicon-16x16.png" sizes="16x16"/> <meta name="generator" content="Jekyll v4.3.1"/> <meta property="og:title" content="Ticket Viewer"/> <meta name="author" content="David Allen"/> <meta property="og:locale" content="en_US"/> <meta name="description" content="Another month, another interesting coding exercise. I haven’t posted much in here lately. The reason is I’ve been working on a fairly large Rails app and haven’t had time, nor brought it to a sufficient state of completion to be worth showing off."/> <meta property="og:description" content="Another month, another interesting coding exercise. I haven’t posted much in here lately. The reason is I’ve been working on a fairly large Rails app and haven’t had time, nor brought it to a sufficient state of completion to be worth showing off."/> <link rel="canonical" href="https://syntheta.se/coding/2017/07/23/ticket-viewer.html"/> <meta property="og:url" content="https://syntheta.se/coding/2017/07/23/ticket-viewer.html"/> <meta property="og:site_name" content="Syntheta.se"/> <meta property="og:type" content="article"/> <meta property="article:published_time" content="2017-07-23T00:00:00+00:00"/> <meta name="twitter:card" content="summary"/> <meta property="twitter:title" content="Ticket Viewer"/> <script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"David Allen"},"dateModified":"2017-07-23T00:00:00+00:00","datePublished":"2017-07-23T00:00:00+00:00","description":"Another month, another interesting coding exercise. I haven’t posted much in here lately. The reason is I’ve been working on a fairly large Rails app and haven’t had time, nor brought it to a sufficient state of completion to be worth showing off.","headline":"Ticket Viewer","mainEntityOfPage":{"@type":"WebPage","@id":"https://syntheta.se/coding/2017/07/23/ticket-viewer.html"},"url":"https://syntheta.se/coding/2017/07/23/ticket-viewer.html"}</script> </head> <body> <div id="page-wrapper"> <header> <noscript> <div id="noscript"> JavaScript is turned off. Please <a href="https://enable-javascript.com/" target="_blank"> enable JavaScript </a> for full use of this site. </div> </noscript> <div id="masthead"> <div id="heading"> <a href="/"> <h1>Synthetase's World of Nerd</h1> </a> </div> </div> <nav id="main-menu"> <button id="nav-icon" type="button"> <i class="fa fa-bars"></i> <i class="fa fa-caret-down" aria-hidden="true"></i> </button> <ul> <li> <a href="/"> Home </a> </li> <li> <a href="/coding/" class="selected"> Coding </a> </li> <li> <a href="/projects/"> Projects </a> </li> <li> <a href="/about/"> About </a> </li> </ul> </nav> </header> <div id="content-wrapper"> <section id="article"> <div class="article-header"> <div class="title-section"> <div class="thumb-container"> <img src="/assets/images/logos/rails.jpg" alt="" aria-hidden="true"/> </div> <div class="post-title"> <h2>Ticket Viewer</h2> </div> </div> <ul class="post-data"> <li> <p> <i class="fa fa-calendar" aria-hidden="false" title="First published"></i><noscript>First published</noscript> 23 July 2017&ensp;|&ensp; </p> </li> <li> <p> <i class="fa fa-edit" aria-hidden="false" title="Last modified"></i><noscript>Last modified</noscript> 28 July 2017&ensp;|&ensp; </p> </li> <li> <p> <i class="fa fa-tags" aria-hidden="false" title="Tags"></i><noscript>Tags</noscript> <a href="/tags/#rails">rails</a>, <a href="/tags/#ruby">ruby</a>, <a href="/tags/#development">development</a>, <a href="/tags/#portfolio">portfolio</a>. </p> </li> </ul> </div> <p>Another month, another interesting coding exercise. I haven’t posted much in here lately. The reason is I’ve been working on a fairly large Rails app and haven’t had time, nor brought it to a sufficient state of completion to be worth showing off.</p> <p>In the middle of this, I was set a coding challenge by Zendesk, a company I applied at, and found a use for my new Rails knowledge. The requirements were to build an app to hit the company API and download support tickets. The tickets must then be displayed to the user, with no more than twenty-five per page. The user must also be able to obtain useful information from the ticket. It’s a fairly simple task, with no requirement to actually manipulate the tickets, just display them.</p> <p>The external ticket API blocks all cross-origin requests, so getting ticket data using a JS front-end framework was out of the question. Since I now have some experience using Rails, I opted for that instead - although I admit a lighter framework would arguably be more appropriate.</p> <div class="article-figure-container"> <figure class="article-figure"> <img src="/assets/images/2017-07/zd_index.jpg" alt="The index page of the ticket viewer app, displaying a list of dummy tickets. It's not pretty, but that wasn't the object of the exercise."/> <figcaption> The index page of the ticket viewer app, displaying a list of dummy tickets. It's not pretty, but that wasn't the object of the exercise. </figcaption> </figure> </div> <h3 id="writing-the-app">Writing the app</h3> <p>The main component of the app was a wrapper for the API. I created a module with getter methods that send GET requests to the service for ticket data. Although not part of the requirements for the challenge, you could easily extend this module and add setter methods which send POST requests to add tickets as well.</p> <p>The getter methods accept an optional hash containing query options which are supported by the external API. This makes it very easy to change the behaviour of the app by simply altering the query parameters. The API supports pagination, so I just used this to satisfy the twenty-five per page part of the requirements.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">ZendeskAPI</span><span class="p">.</span><span class="nf">get_tickets</span><span class="p">(</span><span class="ss">per_page: </span><span class="mi">25</span><span class="p">,</span> <span class="ss">page: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">sort_by: :created_at</span><span class="p">)</span>

<span class="c1">#the query params are easily dealt with:</span>
<span class="n">query_string</span> <span class="o">=</span> <span class="s1">'?'</span> <span class="o">+</span> <span class="n">query_hash</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="o">|</span> <span class="s2">"</span><span class="si">#{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">#{</span><span class="n">v</span><span class="si">}</span><span class="s2">"</span> <span class="p">}.</span><span class="nf">join</span><span class="p">(</span><span class="s1">'&amp;'</span><span class="p">)</span>
</code></pre></div></div> <p>The wrapper module also defines a <code class="language-plaintext highlighter-rouge">Response</code> class for dealing with the API responses. This class handles any errors the API might return and logs them both to file and the console. It also allows the controller to know about errors via a simple <code class="language-plaintext highlighter-rouge">#error?</code> method.</p> <p>If there are no errors, the class stuffs the response data into an instance variable, which allows the controller to access it for rendering the tickets on the page.</p> <p>The rest of the app is pretty straight forward: the controller handles the requests and calls the appropriate getter methods on the API wrapper module, then renders the results on the page. If the API returns an error code, an error message is displayed to the user instead.</p> <div class="article-figure-container"> <figure class="article-figure"> <img src="/assets/images/2017-07/zd_ticket.jpg" alt="Clicking on a ticket in the list shows it in more detail."/> <figcaption> Clicking on a ticket in the list shows it in more detail. </figcaption> </figure> </div> <h3 id="testing-the-app">Testing the app</h3> <p>This is where the real fun begins ;)</p> <p>In my limited experience with Rails, I haven’t done much in the way of testing (I know, I’m a very bad boy…) so it was about time I did some in earnest. I found fairly quickly that I didn’t really like the Rails testing framework as much as <a href="http://rspec.info/">rspec</a>, so I removed it and added rspec to the Gemfile instead.</p> <p>The fun part was having to mock all the external API calls so the tests didn’t actually hit the end-point when running. This is a good idea for several reasons:</p> <ul> <li>It significantly improves the speed of the test suite because you don’t sit around waiting for the API to respond.</li> <li>It allows you to run the tests even if the API is unavailable (or if you’re only allowed a limited number of requests per day and you don’t want to waste them on testing).</li> <li>It allows you to write tests for code that hits APIs that haven’t been written yet.</li> <li>Lastly, (and I think this is probably one of the most important points from a software engineering philosophical standpoint) we aren’t testing the API, we’re testing our own code, so actually hitting the API and checking its responses is outside the scope of the test suite.</li> </ul> <p>If you know the API spec, you know how it will respond to any given request and you can write a mock response for your test suite. To do this I used a gem called <a href="https://github.com/bblimke/webmock">Webmock</a> which makes the whole process ridiculously easy. You can set it so that under a test environment, no external HTTP requests are permitted. Then, if it catches a request, it throws an error to the console telling you exactly what the request was and how to write a mock response for it. Too easy.</p> <p>Just putting up a mock fascade is one thing, but what happens when your program wants to actually <em>do</em> something with the data it thinks is being returned? Since you’re not hitting the external API, you can hardly expect it to give you lots of delicous JSON in response, so what to do? The <a href="https://github.com/thoughtbot/factory_girl">Factory_Girl</a> gem is your friend here. You can use it to instantiate a series of mock objects, so that your code has something to play with.</p> <div class="article-figure-container"> <figure class="article-figure"> <img src="/assets/images/2017-07/zd_test_spec.jpg" alt="The output of the test suite in verbose documentation mode."/> <figcaption> The output of the test suite in verbose documentation mode. </figcaption> </figure> </div> <p>In my case, I created a <code class="language-plaintext highlighter-rouge">Ticket</code> factory that produced a <code class="language-plaintext highlighter-rouge">Ticket</code> object for a single ticket request. Then I simply asked for an array of <code class="language-plaintext highlighter-rouge">Tickets</code> if the request was for a page listing of tickets. I wrapped the call to Factory_Girl in a <code class="language-plaintext highlighter-rouge">MockResponse</code> module and called the module methods in my Webmock response stubs.</p> <p>For end-to-end testing, I used <a href="https://github.com/teamcapybara/capybara">Capybara</a>. Usage is quite intuitive and it was easy to tell it to visit a particular page in the app to verify that it had the elements I expected to see or lacked those that should not have been present.</p> <h3 id="conclusions">Conclusions</h3> <p>I learned a lot about getting a decent test suite up and running in Rails during this exercise. I also learned the value of a good test suite while developing. It was really nice to be able to do a bit of re-factoring and them simply run the suite to verify that everything still worked as expected. I definitely think that spending a bit of time learning this will save me a lot of headaches in the future! :)</p> <div class="git-link-container"> <div class="git-link"> <a href="https://github.com/StaphSynth/zendesk-ticket-viewer" target="_blank"> <i class="fa fa-github-square social" aria-hidden="true"></i>Code on Github </a> </div> </div> </section> </div> <footer> <div id=footer-container> <section id="connect"> <p>Connect with me:</p> <ul> <li> <a href="https://github.com/StaphSynth" target="_blank"> <i class="fa fa-github-square social" aria-hidden="false"></i> </a> </li> <li> <a href="https://www.linkedin.com/in/david-allen-102290119/" data-proofer-ignore target="_blank"> <i class="fa fa-linkedin-square social" aria-hidden="false"></i> </a> </li> <li> <a href="https://syntheta.se/feed.xml"> <i class="fa fa-rss-square social" aria-hidden="false"></i> </a> </li> </ul> </section> <section id="licence"> <ul> <li id="ccLogo"> <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank"> <img src="https://syntheta.se/assets/images/cc.png" alt="Creative commons logo"/> </a> </li> <li>This site is licensed under a Creative Commons <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank"> Attribution-ShareAlike </a> 4.0 International Licence. </li> </ul> </section> </div> </footer> </div> </body> <script type="text/javascript">!function(){function t(){["https://code.jquery.com/jquery-1.11.0.min.js","https://syntheta.se/assets/javascript/synth.js"].forEach(t=>{const e=document.createElement("script");e.src=t,e.type="text/javascript",e.async=!1,document.body.appendChild(e)})}window.addEventListener("load",t,!1)}();</script> </html>