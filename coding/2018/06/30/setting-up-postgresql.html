<!DOCTYPE html> <html> <head> <meta charset="utf-8"/> <meta name="viewport" content="width=device-width, initial-scale=1"/> <title> Setting up Postgres with Rails | Syntheta.se </title> <link rel="alternate" type="application/rss+xml" title="Syntheta.se RSS" href="/feed.xml"/> <link type="text/css" rel="stylesheet" href="/assets/stylesheets/main.css"/> <link rel="icon" type="image/png" href="/assets/images/favicon-32x32.png" sizes="32x32"/> <link rel="icon" type="image/png" href="/assets/images/favicon-16x16.png" sizes="16x16"/> <meta name="generator" content="Jekyll v4.3.2"/> <meta property="og:title" content="Setting up Postgres with Rails"/> <meta name="author" content="David Allen"/> <meta property="og:locale" content="en_US"/> <meta name="description" content="Most of my toy Rails projects have relied on SQLite3 for database duties. This is fine if you don’t need super high performance, but if you’re building something more demanding (perhaps an instant messaging app and need to write to it often), or want to deploy your project to Heroku, then you might consider using PostgreSQL instead."/> <meta property="og:description" content="Most of my toy Rails projects have relied on SQLite3 for database duties. This is fine if you don’t need super high performance, but if you’re building something more demanding (perhaps an instant messaging app and need to write to it often), or want to deploy your project to Heroku, then you might consider using PostgreSQL instead."/> <link rel="canonical" href="https://syntheta.se/coding/2018/06/30/setting-up-postgresql.html"/> <meta property="og:url" content="https://syntheta.se/coding/2018/06/30/setting-up-postgresql.html"/> <meta property="og:site_name" content="Syntheta.se"/> <meta property="og:type" content="article"/> <meta property="article:published_time" content="2018-06-30T00:00:00+00:00"/> <meta name="twitter:card" content="summary"/> <meta property="twitter:title" content="Setting up Postgres with Rails"/> <script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"David Allen"},"dateModified":"2018-06-30T00:00:00+00:00","datePublished":"2018-06-30T00:00:00+00:00","description":"Most of my toy Rails projects have relied on SQLite3 for database duties. This is fine if you don’t need super high performance, but if you’re building something more demanding (perhaps an instant messaging app and need to write to it often), or want to deploy your project to Heroku, then you might consider using PostgreSQL instead.","headline":"Setting up Postgres with Rails","mainEntityOfPage":{"@type":"WebPage","@id":"https://syntheta.se/coding/2018/06/30/setting-up-postgresql.html"},"url":"https://syntheta.se/coding/2018/06/30/setting-up-postgresql.html"}</script> </head> <body> <div id="page-wrapper"> <header> <noscript> <div id="noscript"> JavaScript is turned off. Please <a href="https://enable-javascript.com/" target="_blank"> enable JavaScript </a> for full use of this site. </div> </noscript> <div id="masthead"> <div id="heading"> <a href="/"> <h1>Synthetase's World of Nerd</h1> </a> </div> </div> <nav id="main-menu"> <button id="nav-icon" type="button"> <i class="icon-menu"></i> <i class="icon-down-dir dropdown-caret" aria-hidden="true"></i> </button> <div class="menu-container menu-closed"> <ul class="menu-content"> <li> <a href="/"> Home </a> </li> <li> <a href="/coding/" class="selected"> Coding </a> </li> <li> <a href="/projects/"> Projects </a> </li> <li> <a href="/about/"> About </a> </li> </ul> </div> </nav> </header> <div id="content-wrapper"> <section id="article"> <div class="article-header"> <div class="title-section"> <div class="thumb-container"> <img src="/assets/images/logos/postgres.png" alt="" aria-hidden="true"/> </div> <div class="post-title"> <h2>Setting up Postgres with Rails</h2> </div> </div> <ul class="post-data"> <li> <p> <i class="icon-calendar" aria-hidden="false" title="First published"></i><noscript>First published</noscript> 30 June 2018&ensp;|&ensp; </p> </li> <li> <p> <i class="icon-edit" aria-hidden="false" title="Last modified"></i><noscript>Last modified</noscript> 26 August 2018&ensp;|&ensp; </p> </li> <li> <p> <i class="icon-tags" aria-hidden="false" title="Tags"></i><noscript>Tags</noscript> <a href="/tags/#postgres">postgres</a>, <a href="/tags/#ruby+on+rails">ruby on rails</a>. </p> </li> </ul> </div> <p>Most of my toy Rails projects have relied on SQLite3 for database duties. This is fine if you don’t need super high performance, but if you’re building something more demanding (perhaps an <a href="https://github.com/StaphSynth/ptalk">instant messaging app</a> and need to write to it often), or want to deploy your project to <a href="https://www.heroku.com/">Heroku</a>, then you might consider using <a href="https://www.postgresql.org/">PostgreSQL</a> instead.</p> <p>Setting up Postgres is a little more fiddly than SQLite3 (in that it will <em>need</em> to be set up to work with Rails), so I’ve written some notes here from what I’ve learned for future reference.</p> <h3 id="installation">Installation</h3> <p>Postgres needs to be installed on your system for your Rails app to use it. Installing it is fairly easy, visit the <a href="https://www.postgresql.org/download/">downloads page</a> and pick the method for your operating system. I’m using a macbook for this project, so I installed via <a href="https://brew.sh/">homebrew</a>.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ brew install postgresql
</code></pre></div></div> <p>To start Postgres after installation - and to make sure it’s started as a service every time you boot your mac, you can use the following command:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pg_ctl -D /usr/local/var/postgres start &amp;&amp; brew services start postgresql
</code></pre></div></div> <p>Verify that it is installed and available:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ postgres -V
# =&gt; postgres (PostgreSQL) 10.4
</code></pre></div></div> <h3 id="basic-configuration">Basic Configuration</h3> <p>This can be a little confusing at first, so I model it in my head like a Rails app: the Postgres application “server” can have many <code class="language-plaintext highlighter-rouge">roles</code> (a <code class="language-plaintext highlighter-rouge">role</code> is what Postgres calls a <code class="language-plaintext highlighter-rouge">user</code>). Each <code class="language-plaintext highlighter-rouge">role</code> has a series of permissions which determine what actions can be taken (creating or deleting databases, for example). There are also many <code class="language-plaintext highlighter-rouge">database</code>s, to which individual <code class="language-plaintext highlighter-rouge">role</code>s may or may not have access. Each <code class="language-plaintext highlighter-rouge">role</code> also has a password for authorization.</p> <p>Your Rails application will need to have a <code class="language-plaintext highlighter-rouge">role</code> configured for it to connect to Postgres and use the databases contained therein.</p> <p>On installation, Postgres configures some default <code class="language-plaintext highlighter-rouge">role</code>s for you. It will also attempt to create a <code class="language-plaintext highlighter-rouge">postgres</code> user on your system. I found that if you don’t have root access it won’t be able to (obviously), but that this silently fails (which is kind of annoying, becuase most of the help and tutorials you will find on the net assume that this user exists).</p> <p>To see what Postgres has configured after set up, you need to launch the command line utility.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ psql postgres

# =&gt;
psql (10.4)
Type "help" for help.

postgres=#
</code></pre></div></div> <p>To see the existing roles and their permissions, type <code class="language-plaintext highlighter-rouge">\du</code> (short-hand commands in Postgres are preceeded with a backslash <code class="language-plaintext highlighter-rouge">\</code>).</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                                          List of roles
    Role name     |                         Attributes                         | Member of
------------------+------------------------------------------------------------+-----------
 postgres         | Superuser, Create role, Create DB                          | {}
</code></pre></div></div> <p>To quit the utility, type <code class="language-plaintext highlighter-rouge">\q</code>.</p> <h3 id="creating-a-new-role">Creating a New Role</h3> <p>Before you can use Postgres with your Rails app, you’ll need to create a new role for the app. You <em>could</em> use the existing role(s), but this is a bad idea, since the defaults are widely known and have Superuser privileges.</p> <p>To create a new role, start the utility and type:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>postgres=# CREATE ROLE my_cool_rails_app WITH LOGIN PASSWORD 'super_strong_pw';
# =&gt; CREATE ROLE
</code></pre></div></div> <p>While you’re at it, you should set a password on the default account so it isn’t vulnerable:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>postgres=# \password
</code></pre></div></div> <p>Typing <code class="language-plaintext highlighter-rouge">\du</code> will show your new role, but it won’t have any attributes yet. This means is can’t create, read or update databases. To give it some attributes and make it useful requires some more SQL:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>postgres=# ALTER ROLE my_cool_rails_app CREATEDB;
# =&gt; ALTER ROLE
</code></pre></div></div> <h3 id="useage-with-rails">Useage With Rails</h3> <p>Now that you have a role set up for the Rails app, you need to configure the app to use it. To do this, edit <code class="language-plaintext highlighter-rouge">database.yml</code>.</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">default</span><span class="pi">:</span> <span class="nl">&amp;default</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">postgresql</span>
  <span class="na">encoding</span><span class="pi">:</span> <span class="s">unicode</span>
  <span class="na">pool</span><span class="pi">:</span> <span class="m">5</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s">super_strong_pw</span>

<span class="na">development</span><span class="pi">:</span>
  <span class="na">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*default</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">my_cool_rails_app_development</span>

<span class="na">test</span><span class="pi">:</span>
  <span class="na">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*default</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">my_cool_rails_app_test</span>

<span class="na">production</span><span class="pi">:</span>
  <span class="na">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*default</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">my_cool_rails_app_production</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">my_cool_rails_app</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s">&lt;%= ENV['MY_RAILS_APP_DATABASE_PASSWORD'] %&gt;</span>
</code></pre></div></div> <p>This sets up the databases the Rails app will use in test, development and production. Note the use of an environment variable to pass the production DB password to the app. Obviously, checking production passwords into source control is a <em>very bad idea</em>.</p> <p>Then run:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ rake db:setup &amp;&amp; rails s
</code></pre></div></div> <h3 id="further-reading">Further Reading</h3> <p>Some useful links:</p> <p><a href="https://www.digitalocean.com/community/tutorials/how-to-use-roles-and-manage-grant-permissions-in-postgresql-on-a-vps--2">Using roles and granting permissions</a>, <a href="https://www.digitalocean.com/community/tutorials/how-to-setup-ruby-on-rails-with-postgres">Another Rails how-to guide</a>, <a href="https://www.codementor.io/engineerapart/getting-started-with-postgresql-on-mac-osx-are8jcopb">Installing Postres on MacOS X</a></p> </section> </div> <footer> <div id=footer-container> <section id="connect"> <p>Connect with me:</p> <ul> <li> <a href="https://github.com/StaphSynth" target="_blank"> <i class="icon-github-squared social" title="Github" aria-hidden="false"></i> </a> </li> <li> <a href="https://www.linkedin.com/in/david-allen-102290119/" data-proofer-ignore target="_blank"> <i class="icon-linkedin-squared social" title="LinkedIn" aria-hidden="false"></i> </a> </li> <li> <a href="https://syntheta.se/feed.xml"> <i class="icon-rss-squared social" title="RSS feed" aria-hidden="false"></i> </a> </li> </ul> </section> <section id="licence"> <ul> <li id="ccLogo"> <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank"> <img src="https://syntheta.se/assets/images/cc.png" alt="Creative commons logo"/> </a> </li> <li>This site is licensed under a Creative Commons <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank"> Attribution-ShareAlike </a> 4.0 International Licence. </li> </ul> </section> </div> </footer> </div> </body> <script type="text/javascript">(()=>{const t=()=>{["/assets/javascript/main.js"].forEach(t=>{const e=document.createElement("script");e.src=t,e.type="text/javascript",e.async=!1,document.body.appendChild(e)})};window.addEventListener("load",t)})();</script> </html>